{
  "articles": [
    {
      "path": "data_availability.html",
      "title": "Data availability",
      "description": "Data availability depends on sources\n",
      "author": [
        {
          "name": "Giorgio Comai",
          "url": "https://giorgiocomai.eu"
        }
      ],
      "date": "`r Sys.Date()`",
      "contents": "\nThis page summarises coverage of LAU, NUTS, and population grid datasets at different points in time.\nLAU coverage by year\nSee source for more details.\nhttps://ec.europa.eu/eurostat/web/gisco/geodata/reference-data/administrative-units-statistical-units/lau\n\nyear\nn\n2011\n30\n2012\n35\n2013\n31\n2014\n34\n2015\n34\n2016\n34\n2017\n35\n2018\n37\n2019\n35\n2020\n35\n\n\nyear\ncountry\n2011\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, ES, FI, FR, HU, IE, IS, IT, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2012\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MF, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n2013\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, ES, FI, FR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2014\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n2015\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n2016\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n2017\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MF, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n2018\nAL, AT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, ME, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK, XK\n2019\nAL, AT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n2020\nAL, AT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n\nFor LAU, the most recent dataset is apparently not the one with the widest coverage. Largest coverage may be obtained by using older LAU when the most recent are not available for relevant countries.\nKeep in mind that the apparent coverage may not fully correspond with the actual coverage, e.g. because data for some or all LAUs in a given country may still be missing or have incomplete data (see in particular data for Montenegro, Kosovo, or the coding of French overseas territories).\n\n[1] \"MF\" \"ME\" \"XK\"\n\nPopulation grid coverage by year\nSee source for more details.\n\nyear\nn\n2006\n31\n2011\n31\n2018\n40\n\n\nyear\ncountry\n2006\nAN, AT, BE, BG, CH, CNTR_CODE, CZ, DE, DK, EE, EL, ES, FI, FR, HU, IE, IS, IT, LI, LT, LU, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK\n2011\nAL, AT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IT, LI, LT, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK, XK*\n2018\nAD, AL, AT, BA, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IM, IS, IT, LI, LT, LU, LV, ME, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, SM, UK\n\n\n\n\nHow many countries are present in both the LAU and population grid dataset?\n\n# A tibble: 30 × 4\n   country                                    n lau_year pop_grid_year\n   <chr>                                  <int>    <int>         <dbl>\n 1 AT, BE, BG, CH, CZ, DE, DK, EE, ES, F…    27     2011          2006\n 2 AT, BE, BG, CH, CZ, DE, DK, EE, ES, F…    26     2011          2011\n 3 AT, BE, BG, CH, CY, CZ, DE, DK, EE, E…    30     2011          2018\n 4 AT, BE, BG, CH, CZ, DE, DK, EE, EL, E…    29     2012          2006\n 5 AT, BE, BG, CH, CZ, DE, DK, EE, EL, E…    29     2012          2011\n 6 AT, BE, BG, CH, CY, CZ, DE, DK, EE, E…    34     2012          2018\n 7 AT, BE, BG, CH, CZ, DE, DK, EE, ES, F…    28     2013          2006\n 8 AT, BE, BG, CH, CZ, DE, DK, EE, ES, F…    27     2013          2011\n 9 AT, BE, BG, CH, CY, CZ, DE, DK, EE, E…    31     2013          2018\n10 AT, BE, BG, CH, CZ, DE, DK, EE, EL, E…    29     2014          2006\n# … with 20 more rows\nlau_year\npop_grid_year\nn\ncountry\n2011\n2006\n27\nAT, BE, BG, CH, CZ, DE, DK, EE, ES, FI, FR, HU, IE, IS, IT, LT, LU, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK\n2011\n2011\n26\nAT, BE, BG, CH, CZ, DE, DK, EE, ES, FI, FR, HU, IE, IT, LT, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2011\n2018\n30\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, ES, FI, FR, HU, IE, IS, IT, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2012\n2006\n29\nAT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HU, IE, IS, IT, LI, LT, LU, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK\n2012\n2011\n29\nAT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IT, LI, LT, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2012\n2018\n34\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n2013\n2006\n28\nAT, BE, BG, CH, CZ, DE, DK, EE, ES, FI, FR, HU, IE, IS, IT, LI, LT, LU, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK\n2013\n2011\n27\nAT, BE, BG, CH, CZ, DE, DK, EE, ES, FI, FR, HU, IE, IT, LI, LT, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2013\n2018\n31\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, ES, FI, FR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2014\n2006\n29\nAT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HU, IE, IS, IT, LI, LT, LU, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK\n2014\n2011\n29\nAT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IT, LI, LT, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2014\n2018\n34\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n2015\n2006\n29\nAT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HU, IE, IS, IT, LI, LT, LU, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK\n2015\n2011\n29\nAT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IT, LI, LT, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2015\n2018\n34\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n2016\n2006\n29\nAT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HU, IE, IS, IT, LI, LT, LU, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK\n2016\n2011\n29\nAT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IT, LI, LT, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2016\n2018\n34\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n2017\n2006\n29\nAT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HU, IE, IS, IT, LI, LT, LU, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK\n2017\n2011\n29\nAT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IT, LI, LT, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2017\n2018\n34\nAT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n2018\n2006\n29\nAT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HU, IE, IS, IT, LI, LT, LU, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK\n2018\n2011\n30\nAL, AT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IT, LI, LT, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2018\n2018\n36\nAL, AT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, ME, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n2019\n2006\n29\nAT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HU, IE, IS, IT, LI, LT, LU, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK\n2019\n2011\n30\nAL, AT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IT, LI, LT, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2019\n2018\n35\nAL, AT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n2020\n2006\n29\nAT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HU, IE, IS, IT, LI, LT, LU, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK\n2020\n2011\n30\nAL, AT, BE, BG, CH, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IT, LI, LT, LV, MT, NL, NO, PL, PT, RO, SE, SI, SK, UK\n2020\n2018\n35\nAL, AT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK\n\nAvailability of LAU/NUTS concordance tables\nSee source for details\nNotice that the concordance tables present many inconsistencies and do not fully match the LAU dataset distributed for the correspondent dataset. See this page for some attempts at using the correspondence tables, and this other page for an alternative solution that offers consistent matching based on available data. Consider that full correspondence between LAU and NUTS may be tricky, as changing of LAU boundaries along NUTS boundary may cause some former municipalities to be moved from a NUTS to the other.\n\n\n\n",
      "last_modified": "2021-11-02T10:23:46+01:00"
    },
    {
      "path": "how_is_this_computed.html",
      "title": "How is this computed?",
      "description": "A quick look at different approaches\n",
      "author": [
        {
          "name": "Giorgio Comai",
          "url": "https://giorgiocomai.eu"
        }
      ],
      "date": "`r Sys.Date()`",
      "contents": "\nBasic example with a medium-sized town - Full intersection\nAt the most basic, the appoach at the base of the dataset takes all the cells of the population grid that intersects with a given municipality. In the population grid, each cell has a value, that corresponds to an estimate of how many people live within that given square kilometer.\nIt then calculates a weighted average of the centroids of each cell of the population grid.\nAs the point is to identify a point close the place where most people live, as an optional additional step, the value for each grid is raised to the power of 2 (or even higher), to “push” the point towards the most densely populated areas rather than in the periphery when, for example, more centres are included within the same municipality.\nThis is how it plays out in a rather typical town, with most residents clustered in an area, and few living along the administrative boundary.\nThe centroid points at some location in the mountains, while the population-weighted centre falls nicely into town.\n\n\ngisco_id <- \"IT_007003\"\n\ncurrent_lau_sf <- ll_get_lau_eu(gisco_id = gisco_id)\n\nintersect_sf <- ll_get_population_grid(\n  year = 2018,\n  match_sf = current_lau_sf,\n  match_name = stringr::str_c(gisco_id,\n                              \"lau_2020\",\n                              \"pop_grid_2018\",\n                              \"intersects\",\n                              sep = \"-\"),\n  join = sf::st_intersects,\n  silent = TRUE\n)\n\n\ncustom_ll_map_pop_grid(gisco_id = gisco_id,\n                       pop_grid_sf = intersect_sf,\n                       use_leaflet = TRUE,\n                       differentiate = FALSE) \n\n\n\n{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"http://openstreetmap.org\\\">OpenStreetMap<\\/a> contributors, <a href=\\\"http://creativecommons.org/licenses/by-sa/2.0/\\\">CC-BY-SA<\\/a>\"}]},{\"method\":\"addAwesomeMarkers\",\"args\":[45.7367566627954,7.31137143372342,{\"icon\":\"home\",\"markerColor\":\"blue\",\"iconColor\":\"white\",\"spin\":false,\"squareMarker\":false,\"iconRotate\":0,\"font\":\"monospace\",\"prefix\":\"ion\"},null,null,{\"interactive\":true,\"draggable\":false,\"keyboard\":true,\"title\":\"\",\"alt\":\"\",\"zIndexOffset\":0,\"opacity\":1,\"riseOnHover\":false,\"riseOffset\":250},\"Population-weighted centre\",null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addAwesomeMarkers\",\"args\":[45.7493246187753,7.30228549136785,{\"icon\":\"home\",\"markerColor\":\"purple\",\"iconColor\":\"white\",\"spin\":false,\"squareMarker\":false,\"iconRotate\":0,\"font\":\"monospace\",\"prefix\":\"ion\"},null,null,{\"interactive\":true,\"draggable\":false,\"keyboard\":true,\"title\":\"\",\"alt\":\"\",\"zIndexOffset\":0,\"opacity\":1,\"riseOnHover\":false,\"riseOffset\":250},\"Centroid\",null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addPolygons\",\"args\":[[[[{\"lng\":[7.338635,7.309501,7.297951,7.289354,7.279267,7.272887,7.238789,7.263225,7.284895,7.30559,7.317404,7.339282,7.331387,7.329575,7.334809,7.346263,7.347754,7.342947,7.338635],\"lat\":[45.729577,45.728694,45.726607,45.728904,45.748019,45.75421,45.767478,45.772278,45.764813,45.762851,45.764604,45.768416,45.762493,45.757642,45.746759,45.743565,45.736469,45.735702,45.729577]}]]],null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"#03F\",\"weight\":5,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"#03F\",\"fillOpacity\":0,\"smoothFactor\":1,\"noClip\":false},null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addPolygons\",\"args\":[[[[{\"lng\":[7.279906487809,7.27945798320354,7.29228092133159,7.29272731680385,7.279906487809],\"lat\":[45.721806076876,45.7308088238011,45.7311370234976,45.7221342139971,45.721806076876]}]],[[{\"lng\":[7.29272731680385,7.29228092133159,7.3051039983955,7.30554828464319,7.29272731680385],\"lat\":[45.7221342139971,45.7311370234976,45.7314636733217,45.7224608015403,45.7221342139971]}]],[[{\"lng\":[7.30554828464319,7.3051039983955,7.31792721374094,7.31836939067311,7.30554828464319],\"lat\":[45.7224608015403,45.7314636733217,45.7317887732464,45.7227858394787,45.7224608015403]}]],[[{\"lng\":[7.31836939067311,7.31792721374094,7.3307505667135,7.33119063423963,7.31836939067311],\"lat\":[45.7227858394787,45.7317887732464,45.7321123232449,45.7231093277854,45.7227858394787]}]],[[{\"lng\":[7.33119063423963,7.3307505667135,7.3435740566587,7.3440120146887,7.33119063423963],\"lat\":[45.7231093277854,45.7321123232449,45.7324343232904,45.7234312664337,45.7231093277854]}]],[[{\"lng\":[7.27945798320354,7.27900928611827,7.29183433428213,7.29228092133159,7.27945798320354],\"lat\":[45.7308088238011,45.7398115164794,45.7401397787792,45.7311370234976,45.7308088238011]}]],[[{\"lng\":[7.3307505667135,7.3303103103185,7.34313591066275,7.3435740566587,7.3307505667135],\"lat\":[45.7321123232449,45.7411152645681,45.7414373260381,45.7324343232904,45.7321123232449]}]],[[{\"lng\":[7.3435740566587,7.34313591066275,7.35596164741486,7.35639768292203,7.3435740566587],\"lat\":[45.7324343232904,45.7414373260381,45.7417578372337,45.7327547733564,45.7324343232904]}]],[[{\"lng\":[7.26618437763645,7.26573337710809,7.27856039643694,7.27900928611827,7.26618437763645],\"lat\":[45.7394817040396,45.7484842796,45.7488141549657,45.7398115164794,45.7394817040396]}]],[[{\"lng\":[7.27900928611827,7.27856039643694,7.29138755553978,7.29183433428213,7.27900928611827],\"lat\":[45.7398115164794,45.7488141549657,45.7491424798966,45.7401397787792,45.7398115164794]}]],[[{\"lng\":[7.3303103103185,7.32986986494053,7.3426975765873,7.34313591066275,7.3303103103185],\"lat\":[45.7411152645681,45.7501181518097,45.7504402747314,45.7414373260381,45.7411152645681]}]],[[{\"lng\":[7.34313591066275,7.3426975765873,7.35552542473172,7.35596164741486,7.34313591066275],\"lat\":[45.7414373260381,45.7504402747314,45.7507608470838,45.7417578372337,45.7414373260381]}]],[[{\"lng\":[7.32986986494053,7.32942923046544,7.34225905431872,7.3426975765873,7.32986986494053],\"lat\":[45.7501181518097,45.7591209850245,45.7594431694251,45.7504402747314,45.7501181518097]}]],[[{\"lng\":[7.27811131404319,7.2776620388206,7.29049342251308,7.29094058498873,7.27811131404319],\"lat\":[45.7578167393147,45.7668192695809,45.7671477198574,45.7581451269044,45.7578167393147]}]],[[{\"lng\":[7.29094058498873,7.29049342251308,7.30332494550769,7.30376999514472,7.29094058498873],\"lat\":[45.7581451269044,45.7671477198574,45.767474619082,45.7584719637373,45.7581451269044]}]],[[{\"lng\":[7.30376999514472,7.30332494550769,7.31615660714835,7.31659954385552,7.30376999514472],\"lat\":[45.7584719637373,45.767474619082,45.7677999672275,45.7587972497863,45.7584719637373]}]],[[{\"lng\":[7.31659954385552,7.31615660714835,7.32898840677895,7.32942923046544,7.31659954385552],\"lat\":[45.7587972497863,45.7677999672275,45.7681237642672,45.7591209850245,45.7587972497863]}]],[[{\"lng\":[7.32942923046544,7.32898840677895,7.34182034374329,7.34225905431872,7.32942923046544],\"lat\":[45.7591209850245,45.7681237642672,45.7684460101741,45.7594431694251,45.7591209850245]}]],[[{\"lng\":[7.26483079508625,7.26437921335871,7.27721257065261,7.2776620388206,7.26483079508625],\"lat\":[45.7664892682795,45.7754916815079,45.775821745819,45.7668192695809,45.7664892682795]}]],[[{\"lng\":[7.2776620388206,7.27721257065261,7.29004606799683,7.29049342251308,7.2776620388206],\"lat\":[45.7668192695809,45.775821745819,45.7761502588102,45.7671477198574,45.7668192695809]}]]],null,\"Boundary grid cells\",{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"#03F\",\"weight\":1,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"#03F\",\"fillOpacity\":0.2,\"smoothFactor\":1,\"noClip\":false},null,null,[\"483\",\"843\",\"1547\",\"556\",\"587\",\"1954\",\"3131\",\"799\",\"12\",\"3\",\"469\",\"926\",\"342\",\"17\",\"379\",\"383\",\"23\",\"1\",\"1\",\"13\"],{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addPolygons\",\"args\":[[[[{\"lng\":[7.29228092133159,7.29183433428213,7.30465952147332,7.3051039983955,7.29228092133159],\"lat\":[45.7311370234976,45.7401397787792,45.7404664909119,45.7314636733217,45.7311370234976]}]],[[{\"lng\":[7.3051039983955,7.30465952147332,7.31748484703705,7.31792721374094,7.3051039983955],\"lat\":[45.7314636733217,45.7404664909119,45.7407916528505,45.7317887732464,45.7314636733217]}]],[[{\"lng\":[7.31792721374094,7.31748484703705,7.3303103103185,7.3307505667135,7.31792721374094],\"lat\":[45.7317887732464,45.7407916528505,45.7411152645681,45.7321123232449,45.7317887732464]}]],[[{\"lng\":[7.29183433428213,7.29138755553978,7.30421485376148,7.30465952147332,7.29183433428213],\"lat\":[45.7401397787792,45.7491424798966,45.7494692543656,45.7404664909119,45.7401397787792]}]],[[{\"lng\":[7.30465952147332,7.30421485376148,7.31704229044682,7.31748484703705,7.30465952147332],\"lat\":[45.7404664909119,45.7494692543656,45.7497944783455,45.7407916528505,45.7404664909119]}]],[[{\"lng\":[7.31748484703705,7.31704229044682,7.32986986494053,7.3303103103185,7.31748484703705],\"lat\":[45.7407916528505,45.7497944783455,45.7501181518097,45.7411152645681,45.7407916528505]}]],[[{\"lng\":[7.27856039643694,7.27811131404319,7.29094058498873,7.29138755553978,7.27856039643694],\"lat\":[45.7488141549657,45.7578167393147,45.7581451269044,45.7491424798966,45.7488141549657]}]],[[{\"lng\":[7.29138755553978,7.29094058498873,7.30376999514472,7.30421485376148,7.29138755553978],\"lat\":[45.7491424798966,45.7581451269044,45.7584719637373,45.7494692543656,45.7491424798966]}]],[[{\"lng\":[7.30421485376148,7.30376999514472,7.31659954385552,7.31704229044682,7.30421485376148],\"lat\":[45.7494692543656,45.7584719637373,45.7587972497863,45.7497944783455,45.7494692543656]}]],[[{\"lng\":[7.31704229044682,7.31659954385552,7.32942923046544,7.32986986494053,7.31704229044682],\"lat\":[45.7497944783455,45.7587972497863,45.7591209850245,45.7501181518097,45.7497944783455]}]]],null,\"Within boundary grid cells\",{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"#03F\",\"weight\":1,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"#03F\",\"fillOpacity\":0.2,\"smoothFactor\":1,\"noClip\":false},null,null,[\"6554\",\"9913\",\"4320\",\"280\",\"2124\",\"2950\",\"8\",\"76\",\"705\",\"709\"],{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[45.721806076876,45.7761502588102],\"lng\":[7.238789,7.35639768292203]}},\"evals\":[],\"jsHooks\":[]}\nAs highlighted in the original post outlining this method, there are however a number of situations that may complicate things, including poly-centric municipalities, municipalities with non-contiguous territories, islands, coastal areas, etc.\nExamples of cases where the centre is not quite right\nThere are however cases when a large share of the population lives in cells that cut across the administrative boundary line, and it is unclear on which side of the line they live. In larger centres few will live within 1km of the administrative boundaries, but in smaller location this can be an issue.\nLet’s look at the small Portuguese municipality of “Urros e Peredo dos Castelhanos” (PT_040921): with a total population of 376 residents, mostly living in one of the two locations that give the municipality its name. It so happens that the neighbouring village of Ligares falls largely into one of the cells cutting the boundary, skewing the population weighted centre (in blue). Notice that, by chance, the centroid - in purple, would be fine in this case.\nTo reduce the risk that grid cells crossing the boundary skew the result, this repository includes additional datasets, marked as “adjusted_intersection”, that takes the cells crossing the boundary, and divide the value of the population grid according to the surface of that specific cell that actually falls into the boundary. As you see (green pin), the population-weighted centre thus adjusted falls closer to where we’d want it to be. The difference is negligible in the vast majority of cases, but in particular in mountain locations it is not rare to have large municipalities with lots of residents living close to the boundary lines… in such cases, the adjusted approach is very likely preferrable.\n\n\ngisco_id <- \"PT_040921\"\ncurrent_lau_sf <- ll_get_lau_eu(gisco_id = gisco_id)\n\nintersect_sf <- ll_get_population_grid(\n  year = 2018,\n  match_sf = current_lau_sf,\n  match_name = stringr::str_c(gisco_id,\n                              \"lau_2020\",\n                              \"pop_grid_2018\",\n                              \"intersects\",\n                              sep = \"-\"),\n  join = sf::st_intersects,\n  silent = TRUE\n)\n\n\ncustom_ll_map_pop_grid(gisco_id = gisco_id,\n                       pop_grid_sf = intersect_sf,\n                       use_leaflet = TRUE) %>% \n  addAwesomeMarkers(data = \nll_find_pop_centre(sf_location = current_lau_sf,\n                   sf_population_grid = intersect_sf,\n                   adjusted = TRUE),\n                        popup=\"Adjusted pop-weighted\",\n                        icon = makeAwesomeIcon(icon = \"home\",\n                                               markerColor = \"green\",\n                                               library=\"ion\"))\n\n\n\n{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"http://openstreetmap.org\\\">OpenStreetMap<\\/a> contributors, <a href=\\\"http://creativecommons.org/licenses/by-sa/2.0/\\\">CC-BY-SA<\\/a>\"}]},{\"method\":\"addAwesomeMarkers\",\"args\":[41.0860002347141,-6.98888407423902,{\"icon\":\"home\",\"markerColor\":\"blue\",\"iconColor\":\"white\",\"spin\":false,\"squareMarker\":false,\"iconRotate\":0,\"font\":\"monospace\",\"prefix\":\"ion\"},null,null,{\"interactive\":true,\"draggable\":false,\"keyboard\":true,\"title\":\"\",\"alt\":\"\",\"zIndexOffset\":0,\"opacity\":1,\"riseOnHover\":false,\"riseOffset\":250},\"Population-weighted centre\",null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addAwesomeMarkers\",\"args\":[41.0824786567559,-7.03423390538576,{\"icon\":\"home\",\"markerColor\":\"purple\",\"iconColor\":\"white\",\"spin\":false,\"squareMarker\":false,\"iconRotate\":0,\"font\":\"monospace\",\"prefix\":\"ion\"},null,null,{\"interactive\":true,\"draggable\":false,\"keyboard\":true,\"title\":\"\",\"alt\":\"\",\"zIndexOffset\":0,\"opacity\":1,\"riseOnHover\":false,\"riseOffset\":250},\"Centroid\",null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addAwesomeMarkers\",\"args\":[41.0871390156276,-7.03362298085667,{\"icon\":\"home\",\"markerColor\":\"green\",\"iconColor\":\"white\",\"spin\":false,\"squareMarker\":false,\"iconRotate\":0,\"font\":\"monospace\",\"prefix\":\"ion\"},null,null,{\"interactive\":true,\"draggable\":false,\"keyboard\":true,\"title\":\"\",\"alt\":\"\",\"zIndexOffset\":0,\"opacity\":1,\"riseOnHover\":false,\"riseOffset\":250},\"Adjusted population-weighted centre\",null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addPolygons\",\"args\":[[[[{\"lng\":[-7.103188,-7.105236,-7.102487,-7.085408,-7.085552,-7.079249,-7.076185,-7.066007,-7.059538,-7.050838,-7.050441,-7.036941,-7.030673,-7.01936,-7.011425,-7.005871,-6.99101,-6.975073,-6.974787,-6.971733,-6.97369,-6.969262,-6.967855,-6.969508,-6.978468,-6.986533,-6.994736,-7.011609,-7.03097,-7.049085,-7.052301,-7.058149,-7.103188],\"lat\":[41.082225,41.091792,41.103345,41.121106,41.130129,41.130972,41.126719,41.132177,41.130618,41.122342,41.118228,41.11336,41.114188,41.110641,41.11252,41.106696,41.102719,41.094923,41.083501,41.078041,41.074063,41.069842,41.060562,41.056633,41.051241,41.037734,41.033075,41.040692,41.0396,41.047766,41.057844,41.062702,41.082225]}]]],null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"#03F\",\"weight\":5,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"#03F\",\"fillOpacity\":0,\"smoothFactor\":1,\"noClip\":false},null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addPolygons\",\"args\":[[[[{\"lng\":[-6.98494956167339,-6.98739006364572,-6.97576243212257,-6.97332345132035,-6.98494956167339],\"lat\":[41.0321013016666,41.0408878504226,41.0429061958448,41.0341193164276,41.0321013016666]}]],[[{\"lng\":[-6.9738933586181,-6.97633550940613,-6.96469894629871,-6.96225832005002,-6.9738933586181],\"lat\":[41.0800703123922,41.0888566677738,41.0908739476343,41.0820872613357,41.0800703123922]}]],[[{\"lng\":[-7.09266484868275,-7.09512316857271,-7.08349168805269,-7.08103488935524,-7.09266484868275],\"lat\":[41.0686090639423,41.0773919272789,41.0794231392425,41.0706399429164,41.0686090639423]}]],[[{\"lng\":[-6.97633550940613,-6.97877859995295,-6.96714051178549,-6.96469894629871,-6.97633550940613],\"lat\":[41.0888566677738,41.0976428522663,41.0996604631728,41.0908739476343,41.0888566677738]}]],[[{\"lng\":[-7.10675398639657,-7.10921477304688,-7.09758243390024,-7.09512316857271,-7.10675398639657],\"lat\":[41.0753593558841,41.0841417137272,41.0861746184354,41.0773919272789,41.0753593558841]}]]],null,\"Boundary grid cells\",{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"purple\",\"weight\":1,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"purple\",\"fillOpacity\":0.2,\"smoothFactor\":1,\"noClip\":false},null,null,[\"2\",\"291\",\"1\",\"18\",\"3\"],{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addPolygons\",\"args\":[[[[{\"lng\":[-7.03205866827536,-7.03450843597097,-7.02287517036079,-7.02042692527424,-7.03205866827536],\"lat\":[41.0699651661073,41.0787498639862,41.080773944934,41.0719889151658,41.0699651661073]}]],[[{\"lng\":[-7.02042692527424,-7.02287517036079,-7.01124124454748,-7.00879452245639,-7.02042692527424],\"lat\":[41.0719889151658,41.080773944934,41.0827966659091,41.0740113044459,41.0719889151658]}]],[[{\"lng\":[-7.03450843597097,-7.03695914602486,-7.02532435728626,-7.02287517036079,-7.03450843597097],\"lat\":[41.0787498639862,41.0875343903297,41.0895588032963,41.080773944934,41.0787498639862]}]],[[{\"lng\":[-7.02287517036079,-7.02532435728626,-7.01368890795786,-7.01124124454748,-7.02287517036079],\"lat\":[41.080773944934,41.0895588032963,41.0915818560957,41.0827966659091,41.080773944934]}]],[[{\"lng\":[-7.0767729331108,-7.07923104489028,-7.06759367101411,-7.06513708275897,-7.0767729331108],\"lat\":[41.0990195341367,41.1078025475058,41.1098320388211,41.1010486924614,41.0990195341367]}]],[[{\"lng\":[-7.06513708275897,-7.06759367101411,-7.05595563433085,-7.05350056998804,-7.06513708275897],\"lat\":[41.1010486924614,41.1098320388211,41.111860169754,41.1030764905982,41.1010486924614]}]],[[{\"lng\":[-7.07923104489028,-7.08169010253085,-7.07005120461091,-7.06759367101411,-7.07923104489028],\"lat\":[41.1078025475058,41.1165853889636,41.1186152133992,41.1098320388211,41.1078025475058]}]]],null,\"Within boundary grid cells\",{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"#03F\",\"weight\":1,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"#03F\",\"fillOpacity\":0.2,\"smoothFactor\":1,\"noClip\":false},null,null,[\"2\",\"4\",\"171\",\"56\",\"52\",\"4\",\"41\"],{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addLayersControl\",\"args\":[[],[\"Boundary grid cells\",\"Within boundary grid cells\"],{\"collapsed\":false,\"autoZIndex\":true,\"position\":\"topright\"}]},{\"method\":\"addAwesomeMarkers\",\"args\":[41.0871390156276,-7.03362298085667,{\"icon\":\"home\",\"markerColor\":\"green\",\"iconColor\":\"white\",\"spin\":false,\"squareMarker\":false,\"iconRotate\":0,\"font\":\"monospace\",\"prefix\":\"ion\"},null,null,{\"interactive\":true,\"draggable\":false,\"keyboard\":true,\"title\":\"\",\"alt\":\"\",\"zIndexOffset\":0,\"opacity\":1,\"riseOnHover\":false,\"riseOffset\":250},\"Adjusted pop-weighted\",null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[41.0321013016666,41.132177],\"lng\":[-7.10921477304688,-6.96225832005002]}},\"evals\":[],\"jsHooks\":[]}\nFinal notes\nAlternative solutions for finding the centre include:\nincreasing the disproportionate weight given to cells with larger population size (e.g. using power 5 instead of power 2), in order to facilitate coalescing on the most popoulous centre when more than one included\nuse higher resolution population grids\n\n\n\n",
      "last_modified": "2021-11-02T10:23:50+01:00"
    },
    {
      "path": "index.html",
      "title": "Population-weighted centres of local administrative units (LAU) in Europe",
      "description": "If you need the coordinates of a location, where do you put the centre?\n",
      "author": [
        {
          "name": "Giorgio Comai",
          "url": "https://giorgiocomai.eu"
        }
      ],
      "contents": "\nN.B. This is a work in progress. Ensure that the data provided are fit for purpose.\nThis repository presents datasets of the population-weighted centres of local administrative units in Europe, the scripts used to generate them with different approaches, as well as details on quality checks and peculiarities of the data.\nIt also tries to facilitate matching a given local administrative unit to their correspondent NUTS region.\nMotivation\nwhen showing data points of a local adminsitrative unit (or other territorial boundaries) we often need a specific point on a map to show relevant information. Where should that point fall?\nwhen taking values from a data grid it is often useful to have a specific set of coordinates: which should that be for local administrative units?\nthe LAU/NUTS concordance table distributed by Gisco have inconsistencies, making it a pain to adequately combine data (somewhat puzzingly, each year something else is missing or does not quite match)\nIn reference to population-weighted centres, check out the following blog post for context:\nHow to find the population-weighted centre of local administrative units\nPreliminary notes on terminology and data\nLAU stands for “local administrative unit” and usually coincides with municipalities\nNUTS stands for “nomenclature of territorial units for statistics”; there are NUTS of different levels, including NUTS 3 (mostly province/district/county or equivalent), NUTS 2 (larger regions), NUTS 1 (macro-regions).\nSee the relevant Wikipedia page for details.\nEurostat releases every year an updated datasets with LAUs, including basic statistics about each of them as well as the spatial boundaries in formats that can be read by a number of software packages. The same is true for NUTS, with the exception that they are not updated yearly: recent years of release of NUTS regions include 2021, 2016, and 2013.\nBesides, the coverage of these datasets is not the same across all years, as some countries were not part of the NUTS system earlier on.\nThis discrepancy in release dates means that, as LAUs are merged or change their boundaries, sometimes across different NUTS regions, there may not be perfect concordance between, for example, LAU for 2019 and NUTS for 2016. Eurostat does distribute concordance table, but these are not perfectly consistent (some LAUs are missing for some countries, some countries are missing, etc.).\nThis forces users of these data to make a judgement call: should they use old data? should they manually find where the LAUs missing in the concordance tables are located? Should they mix and match?\nThis repository outlines some possible solutions and provides consistently pre-processed data. The user should still be mindful of the structural imperfection of the results.\nSteps and intermediate datasets\nSince fully consistent concordance tables between LAU and NUTS published by the EU are not available for most years, a first step in the data processing involves situating each LAU in a NUTS region. This is achieved by calculating the overlap between the relevant geometries.\nThis process results in three sets of datasets:\none with the overlap of each LAU in a given year, with the NUTS of a given year (this can be useful, for example, for quality checks or for caching data when processing in bulk) - it is available in the lau_nuts_area folder in this repository for multiple combinations of LAU and NUTS based on data published between 2016 and 2021\none with full concordance between LAU and NUTS, where each LAU is attributed to the LAU where it has most of its surface - it is available in the lau_nuts_concordance_by_geo folder in this repository (N.B. the resulting dataset may not be fully consistent with official statistics as the possibility that a tiny number of LAUs may be misattributed to a neighbouring NUTS cannot be excluded)\na third and probably most useful dataset based on official concordance table, falling back to the above solution when concordance tables are incomplete, is finally distributed. It includes a column calrifying if official concordance tables or matching based on geo-datasets was used. It is available in the lau_nuts_concordance_combo folder in this repository\nIt is finally possible to get back to the original objective of this endeavour: having a ready-made dataset with the population-weighted centres of all LAUs accross Europe. As detailed in the page explaining how population-weighted centres are calculated, there are various elements determining the final coordinates. At this stage, datasets with the following characteristics are available:\nLAU for all years between 2018 and 2020\nNUTS based on 2016 NUTS\npopulation grid based on 2018 data\ndatasets available in separate files by country as well as for all of the EU in a single file\nall datasets are based on “adjusted intersection”, i.e. only a share of residents of the cells crossing the relevant administrative boundary are included, proportional to the part of the cell that falls into the given administrative unit\nin order to “push” the centre towards more densely populated areas, the population-weighted centre is calculated by raising to the power of two the number of residents in each cell. This seems a good solutions for most use cases; the same with other parameters can easily be calculated with the scripts included in this repository.\nAll datasets are available in the lau_centres folder in this repository\n“I just need a dataset with LAU centres, what should I download?”\nThe most recent, consistent, and complete dataset at this stage is probably the one based on LAU for 2020, NUTS for 2016, population-grid for 2018.\nIt is available following this link.\nFuture and forthcoming\nThis dataset may be updated to include datasets based on more recent data, to add coverage for other European countries not included in Eurostat datasets, or to recalculate the population-weighted centres based on high-resolution population grids.\nData availability\nThis repository covers local administrative units as distributed by Europen Union’s Gisco services, and tentatively in nieghbouring jurisdictions.\nThe main determinants of data availability are:\ninclusion of relevant country in the LAU datasets for the relevant year\ncoverage by the EU population grid as distributed by the EU’s Gisco services\nAdditional sources for the population grid include High Resolution Population Density Maps distributed by Facebook.\nGADM for administrative boundaries.\nSources\nLocal Administrative Units (LAU)\nThe original dataset of Local Administrative Units (LAU) can be downloaded from the following link: https://gisco-services.ec.europa.eu/distribution/v2/lau/download/\nLAU can be matched to NUTS via concordance tables: https://ec.europa.eu/eurostat/web/nuts/local-administrative-units\nPopulation grid\nThe population grid can be downloaded from the following link: https://ec.europa.eu/eurostat/web/gisco/geodata/reference-data/population-distribution-demography/geostat\nDetails on how the population grid was generated as well as context on the reliability of the data is included in the factsheet that can be downloaded with the latest available dataset (at the time of writing), based on 2018 data and released in 2021.\nLicensing\n© EuroGeographics for the administrative boundaries (see full licensing details for LAUs)\nLicensing for the population grid dataset varies depening on year and the country originally providing the data. See the relevant page for full details.\nFacebook’s High Resolution Population Density Maps are distributed with a CC-BY license.\nThe processed dataset is distributed with a CC-BY license, crediting EDJNet and, if relevant, linking to this repository.\n\n\n\n",
      "last_modified": "2021-11-02T10:23:50+01:00"
    },
    {
      "path": "lau_nuts_botched.html",
      "title": "Botched attempts at combining LAU and NUTS",
      "description": "Why is this such a pain?\n",
      "author": [
        {
          "name": "Giorgio Comai",
          "url": "https://giorgiocomai.eu"
        }
      ],
      "date": "`r Sys.Date()`",
      "contents": "\nRequirements\na consistent dataset with a population-weighted centre for all LAU\nall LAUs need to be paired to a NUTS region\nto the extent that is possible, the resulting dataset should not have unexpected missing data\nThis page outlines early and unfinished attempts to verify the full coverage of the concordance tables. Its only purpose is to illustrate how matching LAUs to NUTs is not straightforward, in spite of the fact that concordance tables exist.\nLAU 2018\nLet’s start from the 2018 LAU dataset distributed by GISCO.\n\n\nlau_2018_df <- ll_get_lau_eu(year = 2018) %>%\n  sf::st_drop_geometry()\n\n\n\nThe dataset has some inconsistencies and incomplete data.\nLooking only at mainland Europe (excluding from the map French overseas territories for clarity), we already notice that Bosnia and (as we’ll see) to some extent Kosovo are not included in the dataset.\n\n\nll_get_nuts_eu(year = 2016, level = 0) %>% \n  dplyr::filter(CNTR_CODE %in% unique(lau_2018_df$CNTR_CODE)) %>% \n  ggplot() +\n  geom_sf() +\n  scale_x_continuous(limits = c(-30, 35)) +\n  scale_y_continuous(limits = c(25, NA)) +\n  theme_minimal()\n\n\n\n\nThere are however other issues.\nMissing place names\nFor some reason, a considerable number of municipalities included in the dataset do not have the name included:\n\n\nll_get_lau_eu(year = 2018) %>% \n    sf::st_drop_geometry() %>% \n  dplyr::group_by(CNTR_CODE) %>% \n  dplyr::add_count(name = \"total_lau_per_country\") %>% \n  filter(is.na(LAU_NAME)) %>% \n  dplyr::group_by(CNTR_CODE, total_lau_per_country) %>% \n  dplyr::count(name = \"missing_lau_name_per_country\") %>% \n  dplyr::ungroup() %>% \n  dplyr::mutate(missing_share = missing_lau_name_per_country/total_lau_per_country)\n\n\n# A tibble: 5 × 4\n  CNTR_CODE total_lau_per_country missing_lau_name_per_… missing_share\n  <chr>                     <int>                  <int>         <dbl>\n1 CH                         2266                     48        0.0212\n2 ME                            3                      3        1     \n3 NO                          422                    422        1     \n4 SI                          212                     99        0.467 \n5 XK                           39                     39        1     \n\nSo all LAU names are missing for Montenegro, Norway, and Kosovo. Almost half of them are missing for Slovenia. About two per cent are missing in Switzerland.\nThe total number of LAUs in Montenegro is suspicioulsy low, so we will have to check that as well.\nSwitzerland: missing place names\n\n\nmissing_ch_df <- ll_get_lau_eu(year = 2018) %>% \n  sf::st_drop_geometry() %>% \n  dplyr::filter(CNTR_CODE == \"CH\") %>% \n  dplyr::filter(is.na(LAU_NAME))\n\n\n\nIn Switzerland there are 48 municipalities with missing name. They are apparently overwhelmingly from mountain and/or border locations.\n\n\nggplot() +\n    geom_sf(data = ll_get_nuts_eu(year = 2016,\n               level = 0,\n               resolution = 1) %>% \n  dplyr::filter(CNTR_CODE == \"CH\")) +\n  geom_sf(data = ll_get_lau_eu(year = 2018) %>% \n  dplyr::filter(CNTR_CODE == \"CH\") %>% \n  dplyr::filter(is.na(LAU_NAME)==FALSE), fill = \"lightgreen\") +\n  geom_sf(data = ll_get_lau_eu(year = 2018) %>% \n  dplyr::filter(CNTR_CODE == \"CH\") %>% \n  dplyr::filter(is.na(LAU_NAME)), fill = \"pink\") +\n  theme_minimal()\n\n\n\n\nThe concordance tables for 2018 are of no help.\n\n\nmissing_ch_df %>% \n  dplyr::left_join(y = ll_get_lau_nuts_concordance(lau_year = 2018) %>% \n  dplyr::filter(country == \"CH\") %>% \n    dplyr::rename(GISCO_ID = gisco_id),\n  by = \"GISCO_ID\")\n\n\n# A tibble: 48 × 15\n   GISCO_ID  CNTR_CODE LAU_ID LAU_NAME POP_2018 POP_DENS_2 AREA_KM2\n   <chr>     <chr>     <chr>  <chr>       <int>      <dbl>    <dbl>\n 1 CH_CH6417 CH        CH6417 <NA>         8964       209.   42.9  \n 2 CH_CH9040 CH        CH9040 <NA>           NA        NA     8.03 \n 3 CH_CH9051 CH        CH9051 <NA>           NA        NA    55.7  \n 4 CH_CH9052 CH        CH9052 <NA>           NA        NA    17.0  \n 5 CH_CH9053 CH        CH9053 <NA>           NA        NA    10.4  \n 6 CH_CH9073 CH        CH9073 <NA>           NA        NA    45.9  \n 7 CH_CH9089 CH        CH9089 <NA>           NA        NA    28.4  \n 8 CH_CH9149 CH        CH9149 <NA>           NA        NA    37.7  \n 9 CH_CH9150 CH        CH9150 <NA>           NA        NA     0.401\n10 CH_CH9152 CH        CH9152 <NA>           NA        NA     2.12 \n# … with 38 more rows, and 8 more variables: YEAR <int>, FID <chr>,\n#   country <chr>, nuts_2 <chr>, nuts_3 <chr>, lau_id <chr>,\n#   lau_name_national <chr>, lau_name_latin <chr>\n\n\n\nggplot() +\n    geom_sf(data = ll_get_nuts_eu(year = 2016,\n               level = 0,\n               resolution = 1) %>% \n  dplyr::filter(CNTR_CODE == \"CH\")) +\n  geom_sf(data = ll_get_lau_eu(year = 2019) %>% \n  dplyr::filter(CNTR_CODE == \"CH\") %>% \n  dplyr::filter(is.na(LAU_NAME)==FALSE), fill = \"lightgreen\") +\n  geom_sf(data = ll_get_lau_eu(year = 2018) %>% \n  dplyr::filter(CNTR_CODE == \"CH\") %>% \n  dplyr::filter(is.na(LAU_NAME)), fill = \"pink\") +\n  theme_minimal()\n\n\n\n\nNorway: missing place names\nThe dataset for 2018 does not include the name of municipalities in Norway. So we have their boundaries, but not their name. Unfortunately, they are also not included in the relevant LAU/NUTS concordance tables for 2018.\n\n\nno_2018_df <- ll_get_lau_eu(year = 2018) %>% \n  sf::st_drop_geometry() %>% \n  filter(CNTR_CODE==\"NO\") %>% \n  dplyr::select(GISCO_ID, CNTR_CODE, LAU_ID, LAU_NAME) %>% \n  dplyr::arrange(GISCO_ID)\n\nno_2018_df\n\n\n# A tibble: 422 × 4\n   GISCO_ID CNTR_CODE LAU_ID LAU_NAME\n   <chr>    <chr>     <chr>  <chr>   \n 1 NO_0101  NO        0101   <NA>    \n 2 NO_0104  NO        0104   <NA>    \n 3 NO_0105  NO        0105   <NA>    \n 4 NO_0106  NO        0106   <NA>    \n 5 NO_0111  NO        0111   <NA>    \n 6 NO_0118  NO        0118   <NA>    \n 7 NO_0119  NO        0119   <NA>    \n 8 NO_0121  NO        0121   <NA>    \n 9 NO_0122  NO        0122   <NA>    \n10 NO_0123  NO        0123   <NA>    \n# … with 412 more rows\n\nll_get_lau_nuts_concordance(lau_year = 2018) %>% \n  dplyr::filter(country==\"NO\")\n\n\n# A tibble: 0 × 7\n# … with 7 variables: country <chr>, nuts_2 <chr>, nuts_3 <chr>,\n#   lau_id <chr>, gisco_id <chr>, lau_name_national <chr>,\n#   lau_name_latin <chr>\n\nThe names are however included in the 2019 dataset. Bar for one municipality.\n\n\nlau_no_with_names <- ll_get_lau_eu(year = 2018) %>% \n  sf::st_drop_geometry() %>% \n  filter(CNTR_CODE==\"NO\") %>% \n  dplyr::select(-LAU_NAME) %>% \n  dplyr::left_join(y = ll_get_lau_eu(year = 2019) %>% \n                     sf::st_drop_geometry() %>% \n                     dplyr::filter(CNTR_CODE==\"NO\") %>% \n                     dplyr::select(GISCO_ID, LAU_NAME),\n                   by = \"GISCO_ID\")\n\nlau_no_with_names %>% \n  dplyr::filter(is.na(LAU_NAME))\n\n\n# A tibble: 1 × 9\n  GISCO_ID CNTR_CODE LAU_ID POP_2018 POP_DENS_2 AREA_KM2  YEAR FID    \n  <chr>    <chr>     <chr>     <int>      <dbl>    <dbl> <int> <chr>  \n1 NO_1567  NO        1567       2026       3.21     632.  2017 NO_1567\n# … with 1 more variable: LAU_NAME <chr>\n\nBut we’re lucky enough to find the name of that municipality in the 2017 dataset:\n\n\nlau_no_with_names$LAU_NAME[lau_no_with_names$GISCO_ID==\"NO_1567\"] <- \n  ll_get_lau_eu(gisco_id = \"NO_1567\", year = 2017) %>% \n  sf::st_drop_geometry() %>% \n  dplyr::pull(LAU_NAME)\n\n\n\nIs there more?\n…\nLAU 2019\nKeeping the LAU for 2019 as point of reference has the advantage of being available to rely on validated concordance tables between LAU and NUTS, not yet available for 2020 as of this writing in October 2021.\nLet’s start from the 2019 LAU dataset distributed by GISCO.\n\n\nlau_2019_df <- ll_get_lau_eu(year = 2019) %>%\n  sf::st_drop_geometry()\n\n\n\nLooking only at mainland Europe (excluding from the map French overseas territories for clarity), we notice that part of the Western Balkans is missing (namely, Bosnia Hercegovina, Montenegro, Kosovo).\n\n\nll_get_nuts_eu(year = 2016, level = 0) %>% \n  dplyr::filter(CNTR_CODE %in% unique(lau_2019_df$CNTR_CODE)) %>% \n  ggplot() +\n  geom_sf() +\n  scale_x_continuous(limits = c(-30, 35)) +\n  scale_y_continuous(limits = c(25, NA)) +\n  theme_minimal()\n\n\n\n\n\n\nmissing_df <- ll_get_lau_eu(year = 2019, silent = TRUE) %>% \n  sf::st_drop_geometry() %>% \n  dplyr::transmute(gisco_id = GISCO_ID) %>% \n  dplyr::left_join(y = ll_get_lau_nuts_concordance(lau_year = 2019,\n                            nuts_year = 2016) %>% \n                     dplyr::rename(lau_name = lau_name_national),\n                   by = \"gisco_id\") %>% \n  dplyr::filter(is.na(lau_name))\n\n\n\nIt appears that 1 130 LAUs are missing from the official concordance tables for 2019.\n…\n\n\n\n",
      "last_modified": "2021-11-02T10:26:28+01:00"
    },
    {
      "path": "lau_nuts.html",
      "title": "LAU and NUTS",
      "description": "Can they be friends?\n",
      "author": [
        {
          "name": "Giorgio Comai",
          "url": "https://giorgiocomai.eu"
        }
      ],
      "date": "`r Sys.Date()`",
      "contents": "\nCombining LAU and NUTS using publicly available datasets is not as straightforward as it may seem, due to small inconsistencies in the data, the cumbersome and internally inconsistent format chosen by GISCO to distribute the concordance tables, and first of all, the puzzling choice not to include reference to NUTS in the datasets with local administrative units to begin with.\nThere does not seem to be any combination of concordance tables that fully match with the LAU dataset for the relevant year. Mixing and matching between different years may for different countries may eventually bring us closer to the desired outcome, but may lead to some inconsistencies of its own.\nFind below more details about proposed viable tables that offer full matching with the LAU of the relevant year, i.e. 100% of the LAUs are paired to a NUTS region.\nLAU 2020 / NUTS 2021\nUntil Gisco finally distributes a consistent dataset (hopefully LAU 2021/NUTS2021), rather than mixing and matching, we decided to calculate belonging to a NUTS region based on the most recently distributed geographic dataset: LAU 2020/NUTS 2021. This may still potentially lead to some inconsistencies for LAUs with recently changed borders along the adminsitrative boundary of some NUTS region, but, all things considered, this is expected to offer an accurate dataset, possibly bar a handful of cases.\n\n\n\nThe area covered by both datasets (LAU 2020 / NUTS 2021) includes 35 countries: AL, AT, BE, BG, CH, CY, CZ, DE, DK, EE, EL, ES, FI, FR, HR, HU, IE, IS, IT, LI, LT, LU, LV, MK, MT, NL, NO, PL, PT, RO, RS, SE, SI, SK, UK.\n\n\n\nHow reliable is the matching?\n\n\n\nGiven some inconsistencies and different resolution we expect LAUs located along a NUTS boundary line to not match exactly with NUTS. We expect a difference up to 10, perhaps 20 percent, to be likely attributable to mismatches in the geo dataset, no actual changes on the ground.\nAs a consequence, there are probably just a handful of cases where the matching is not perfectly accurate.\nHere is a full list of LAUs which, according to available datasets, do not have more than 90% of their area within a given NUTS:\n\ngisco_id\nnuts_3\narea\narea_share\nDE_07333056\nDEB3D\n1706254.5\n0.8986020\nRO_154308\nRO317\n61297860.9\n0.8974089\nNL_GM0394\nNL329\n184536245.3\n0.8943929\nCH_CH9327\nCH052\n167441.0\n0.8940607\nEL_45080201\nEL303\n687968.5\n0.8655517\nEL_02050206\nEL514\n3765168.8\n0.8515297\nFR_39140\nFRC22\n759160.4\n0.8509431\nDE_01053075\nDEF06\n2673362.4\n0.8364477\nRO_153062\nRO317\n75527939.8\n0.8363154\nDE_16072013\nDEG0H\n80315831.6\n0.7433631\nNL_GM1952\nNL113\n213183034.7\n0.7230271\nNL_GM1961\nNL33A\n110046868.2\n0.7204488\nDE_16054000\nDEG04\n101274434.3\n0.7112290\nFR_44180\nFRG01\n125043370.5\n0.6576246\nFR_50592\nFRD12\n21616442.2\n0.6192706\nAT_61061\nAT225\n29079891.7\n0.6074245\nDE_16066095\nDEG0B\n53852351.4\n0.5690889\n\nHow consistent is the matching?\nDo all LAUs have their own NUTS? Here is a complete table of LAUs that are not paired to any NUTS:\n\ngisco_id\nnuts_3\n\nYes. Full match. 😍\nAccessing the dataset\nThe following datasets generated with this approach are currently available:\nLAU 2020/NUTS 2021 for all of Europe, or by country\nFinal considerations\n\n\n\n",
      "last_modified": "2021-11-02T10:26:41+01:00"
    }
  ],
  "collections": []
}
